<!-- New edit & new form -->
<div class='container center'>
<%= nested_form_for @pin, :html => {:multipart => true, :class => "form-horizontal"} do |f| %>

  <% if @pin.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@pin.errors.count, "error") %> prohibited this pin from being saved:</h2>
      <ul>
        <% @pin.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="top-block span5"><center><i class="fa fa-pencil"></i></center></div>
  <div class="top-block span5"><center><i class="fa fa-camera"></i></center></div>

  <div class="submission_well span5 control-group">
    <% f.hidden_field :id %>

    <div class="control-group">
      <label class="control-label">Surgeon</label>
      <div class="controls">
        <% if f.object.surgeon.nil? %>
          <%= f.select :surgeon_id, options_from_collection_for_select(Surgeon.order('last_name ASC'), 'id', 'to_s', 911) %>
          <%= f.link_to_add '<i class="fa fa-plus-circle"></i>'.html_safe, :surgeon %>
        <% else %>
          <%= f.select :surgeon_id, options_from_collection_for_select(Surgeon.order('last_name ASC'), 'id', 'to_s', @pin.surgeon.id) %>
        <% end %>
      </div>
    </div>

     <% if f.object.surgeon.nil? %>
       <%= f.fields_for :surgeon do |surgeon_form| %>
          <div class="well form-control">
            <%= surgeon_form.text_field :last_name, placeholder: "Surgeon's last name" %>
            <%= surgeon_form.text_field :first_name, placeholder: "Surgeon's first name" %>
            <%= surgeon_form.text_field :url, placeholder: "Surgeon's URL" %>
            <br>
            <%= surgeon_form.link_to_remove "Remove this surgeon" %>
          </div>
        <% end %>
    <% end %>

    <div class="control-group">
      <label class="control-label">Procedure</label>
      <div class="controls">
        <% if f.object.procedure.nil? %>
          <%= f.select :procedure_id, options_from_collection_for_select(Procedure.all.sort, 'id', 'to_s') %>
          <%= f.link_to_add '<i class="fa fa-plus-circle"></i>'.html_safe, :procedure %>
        <% else %>
          <%= f.select :procedure_id, options_from_collection_for_select(Procedure.all.sort, 'id', 'to_s', @pin.procedure.id) %>
        <% end %>
      </div>
    </div>

    <% if f.object.procedure.nil? %>
      <%= f.fields_for :procedure do |procedure_form| %>
        <div class="submission_well form-control">
            <%= procedure_form.text_field :name, placeholder: "Name of procedure" %>
            <label>Type
            <%= procedure_form.select :body_type, options_for_select([ "Top", "Bottom", "Face", "Other" ]) %>
          </label>
          <label>Gender
            <%= procedure_form.select :gender, options_for_select([ "FTM", "MTF" ]) %>
          </label>
          <%= procedure_form.link_to_remove "Remove this procedure" %>
        </div>
      <% end %>
    <% end %>

    <div class="control-group">
      <label class="control-label">Cost</label>
      <div class="controls"><%= f.text_field :cost %></div>
    </div>

    <div class="control-group">
      <label class="control-label">Post-op Sensation</label>
      <div class="controls">
        <% 5.times do |i| %>
          <%= radio_button(:pin, :sensation, i, {class: "star"}) %>
        <% end %>
      </div>
    </div>

    <div class="control-group">
      <label class="control-label">Post-op Satisfaction</label>
      <div class="controls">
        <% 5.times do |i| %>
          <%= radio_button(:pin, :satisfaction, i, {class: "star"}) %>
        <% end %>
      </div>
    </div>

      <div class="control-group">
        <label class="checkbox control-label">Seeking a revision</label>
        <div class="controls">
          <%= f.check_box :revision %>
        </div>
      </div>

    <div class="control-group">
      <label class="control-label">Details</label>
      <div class="controls">
        <%= f.text_area :details, :cols => "200", :rows => "10" %>
      </div>
    </div>

    <div class="form-actions">
      <%= f.submit "Submit Now", :class => 'btn btn-primary' %>
    </div>
  </div>
  <div class="submission_well span5">
    <p>We recommend listing images from "Before" to "After", top to bottom in the form.</p>
    <% count = -1 %>
      <%= f.fields_for :pin_images do |ff| %>
        <div id='<%= ff.object.id %>' class='well'>
          <% count += 1 %>
          <div class="control-group">
            <label class="control-label">Caption</label>
            <div class="controls">
              <%= ff.text_field :caption %>
            </div>
          </div>

          <% if ff.object.persisted? %>
            <label>Image File: <%= image_tag ff.object.photo %></label>
            <%= link_to('<i class="fa fa-trash-o"></i>'.html_safe, pin_pin_image_path(@pin, ff.object.id), method: "delete", remote: true, data: { confirm: 'Are you sure?', disable_with: 'deleting...' }) %>
          <% else %>
            <%= ff.link_to_remove '<i class="fa fa-trash-o"></i>'.html_safe %>
          <% end %>

          <div class="input-append pull-right">
            <input id="photoCover<%= count %>" class="input-large" type="text">
            <a class="btn" onclick="$('input[id=pin_pin_images_attributes_<%= count %>_photo]').click();">Browse</a>
          </div>
          <%= ff.file_field(:photo, accept:'image/png,image/jpg,image/jpeg', class: 'hidden') %>

          <%= ff.hidden_field :_destroy %>
          <br clear="both">
        </div>

        <script type="text/javascript">
          $('input[id=pin_pin_images_attributes_<%= count %>_photo]').change(function() {
          $('#photoCover<%= count %>').val($(this).val());
          });
        </script>

      <% end %>
      <div class="form-actions">
        <%= f.link_to_add "Add another photo", :pin_images, :class => 'btn btn-success' %>
      </div>
    <% end %>
  </div>
</div>

<%= render 'pins/surgeon_complete' %>