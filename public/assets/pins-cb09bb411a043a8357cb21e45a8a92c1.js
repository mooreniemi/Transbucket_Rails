$(document).ready(function(){var e=location.pathname.match(/pins\/(?:new|[^/]+\/edit)/);if(e){var i="pins/new"!==e[0],n=$("#preview-template").html(),a=-1;Dropzone.autoDiscover=!1,$("#submit-all").prop("disabled",!0);var t={previewsContainer:"#dropper",clickable:"#dropper",maxFilesize:1,previewTemplate:n,paramName:function(e){return"pin_images["+e+"][photo]"},addRemoveLinks:!0,headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")},autoProcessQueue:!1,uploadMultiple:!0,parallelUploads:100,maxFiles:10,init:function(){var e=document.querySelector("#submit-all");o=this,e.addEventListener("click",function(e){e.preventDefault(),o.processQueue()})}},o=new Dropzone(".form-inline",t);o.on("addedfile",function(e){$(".dz-message:visible").hide(),$(".dz-preview:last-child").attr("id","LM-"+e.lastModified),$("#submit-all").prop("disabled",!1)}),o.on("removedfile",function(e){0==$(".dz-preview:visible").length&&($(".dz-message").show(),$("#submit-all").prop("disabled",!0)),i&&$.ajax({url:"pin_images/"+e.id,type:"DELETE"})}),o.on("sending",function(e,i,n){var t="#LM-"+e.lastModified+" .caption";a+=1,n.append("pin_images["+a+"]caption",$(t).val())}),o.on("sendingmultiple",function(){tinyMCE.triggerSave()}),o.on("successmultiple",function(e,i){window.location.href="/pins/"+i.id}),o.on("errormultiple",function(e,i){$("#error_explanation ul").empty(),i.forEach(function(e){$("#error_explanation ul").append("<li>"+e+"</li>")})}),i&&($(".dz-message:visible").hide(),$.getJSON("pin_images.json",function(e){return e&&e.forEach(function(e){o.options.addedfile.call(o,e),$(e.previewElement).data("pin-image-id",e.id),$(e.previewElement).children("input").val(e.caption),o.options.thumbnail.call(o,e,e.url)}),$("input.caption").on("change",function(e){var i=$(this.parentElement).data("pin-image-id"),n=$(this),a=n.val();$.ajax({url:"/pin_images/"+i+".json",type:"PUT",data:{id:i,caption:a},success:function(){n.css("border-color","green"),n.append("\u2714")}})}),e}))}});